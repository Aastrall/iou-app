<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IOU | Hyper-Neon Finance</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC_O89rLpoYzVZ4ERKBmirOIGhOwwulCIs",
            authDomain: "iou-app-b7ed2.firebaseapp.com",
            databaseURL: "https://iou-app-b7ed2-default-rtdb.firebaseio.com",
            projectId: "iou-app-b7ed2",
            storageBucket: "iou-app-b7ed2.firebasestorage.app",
            messagingSenderId: "607906588480",
            appId: "1:607906588480:web:a64b8ca13884ef5582fca5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
    </script>

    <style>
        :root { --neon: #00FF41; --bg: #000000; }
        body { background-color: var(--bg); color: var(--neon); font-family: sans-serif; overflow-x: hidden; }
        .glass { background: rgba(0, 255, 65, 0.05); border: 1px solid rgba(0, 255, 65, 0.3); backdrop-filter: blur(10px); }
        .neo-btn { background-color: var(--neon); color: #000; font-weight: 900; box-shadow: 0 0 15px rgba(0, 255, 65, 0.4); }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .avatar-circle { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--neon); }
        .chat-img { max-width: 200px; border-radius: 15px; border: 1px solid var(--neon); margin: 5px 0; }
        input { background: #0a0a0a !important; border: 1px solid var(--neon) !important; color: white !important; }
        .logo-frame { width: 180px; height: 180px; margin: 0 auto; border-radius: 2rem; overflow: hidden; border: 3px solid var(--neon); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 5px var(--neon); } 50% { box-shadow: 0 0 25px var(--neon); } }
    </style>
</head>
<body class="min-h-screen">

    <input type="file" id="pPicker" class="hidden" accept="image/*" onchange="upImg(this, 'p')">
    <input type="file" id="cPicker" class="hidden" accept="image/*" onchange="upImg(this, 'c')">

    <div id="authSection" class="fixed inset-0 z-[5000] bg-black flex items-center justify-center p-6 text-center">
        <div class="w-full max-w-md">
            <div class="logo-frame mb-8">
                <img src="https://i.postimg.cc/8z9X689C/IOU-LOGO-CUSTOM.png" class="w-full h-full object-cover">
            </div>
            <h1 id="authTitle" class="text-3xl font-black italic mb-8 tracking-widest uppercase">IOU SIGN IN</h1>
            <div id="loginForm" class="glass p-8 rounded-[2rem]">
                <input type="email" id="email" placeholder="EMAIL ADDRESS" class="w-full p-4 rounded-xl mb-4 font-bold uppercase outline-none">
                <input type="password" id="pass" placeholder="PASSWORD" class="w-full p-4 rounded-xl mb-2 font-bold outline-none">
                <div class="text-right mb-6"><button onclick="forgotPass()" class="text-[10px] font-bold uppercase underline">Reset Key?</button></div>
                <button id="mainBtn" onclick="handleAuth()" class="w-full neo-btn py-4 rounded-xl uppercase mb-4">Authorize</button>
                <p class="text-xs font-bold opacity-60">
                    <span id="tText">NEW TO THE NETWORK?</span> 
                    <button onclick="toggleAuth()" id="tBtn" class="underline ml-1">CREATE ACCOUNT</button>
                </p>
            </div>
            <div id="infoBox" class="hidden glass p-8 rounded-[2rem]">
                <p id="infoTitle" class="font-black mb-4"></p>
                <button onclick="location.reload()" class="neo-btn px-6 py-2 rounded-xl text-xs">BACK</button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden h-screen flex flex-col">
        <header class="p-6 border-b border-white/10 flex justify-between items-center bg-black">
            <div class="flex items-center gap-3 cursor-pointer" onclick="document.getElementById('pPicker').click()">
                <div id="hAv"></div>
                <div>
                    <p id="hName" class="font-black text-xs text-white uppercase">USER</p>
                    <p id="hID" class="text-[9px] font-bold opacity-50">#ID</p>
                </div>
            </div>
            <button onclick="auth.signOut().then(()=>location.reload())" class="text-[9px] border border-white/20 px-4 py-1 rounded-full">EXIT</button>
        </header>

        <main class="flex-1 overflow-y-auto p-6 pb-24 no-scrollbar">
            <section id="page-home" class="page active">
                <div class="glass p-8 rounded-[2rem] text-center mb-8 border-2 border-[#00FF41]">
                    <p class="text-[10px] font-black opacity-50 mb-1 uppercase tracking-widest">Total Credits</p>
                    <h2 id="bal" class="text-6xl font-black text-white">$0.00</h2>
                </div>
                <div class="grid grid-cols-4 gap-4 text-center mb-10">
                    <button onclick="navTo('finance')" class="text-2xl">üí≥</button>
                    <button onclick="navTo('social')" class="text-2xl">üí¨</button>
                    <button onclick="navTo('save')" class="text-2xl">üéØ</button>
                    <button onclick="navTo('social')" class="text-2xl">üë•</button>
                </div>
                <h3 class="text-[10px] font-black opacity-30 uppercase tracking-widest mb-4">Connections</h3>
                <div id="fList" class="space-y-4"></div>
            </section>

            <section id="page-social" class="page">
                <div class="flex gap-2 mb-6">
                    <input id="fInput" placeholder="LINK ID" class="flex-1 p-3 rounded-xl uppercase text-xs">
                    <button onclick="addFriend()" class="neo-btn px-6 rounded-xl font-black">+</button>
                </div>
                <div id="socialList" class="space-y-4"></div>
            </section>

            <section id="page-save" class="page">
                <div class="glass p-8 rounded-[2rem] text-center border-2 border-[#00FF41]">
                    <h2 class="text-xl font-black mb-4">SAVINGS TARGET</h2>
                    <div class="w-full bg-white/10 h-3 rounded-full overflow-hidden mb-4">
                        <div id="sBar" class="bg-[#00FF41] h-full" style="width:0%"></div>
                    </div>
                    <button onclick="deposit()" class="neo-btn px-6 py-2 rounded-xl text-[10px]">ADD $50</button>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-0 inset-x-0 p-6 glass border-t border-white/10 flex justify-around bg-black/80">
            <button onclick="navTo('home')">üè†</button>
            <button onclick="navTo('social')">üë•</button>
            <button onclick="navTo('save')">üéØ</button>
        </nav>
    </div>

    <div id="chatBox" class="hidden fixed inset-0 bg-black z-[6000] flex flex-col">
        <header class="p-6 border-b border-white/10 flex justify-between items-center">
            <h2 id="cName" class="font-black uppercase tracking-widest text-sm">CHANNEL</h2>
            <button onclick="closeChat()" class="text-[10px] border border-white/20 px-3 py-1 rounded">BACK</button>
        </header>
        <div id="msgs" class="flex-1 overflow-y-auto p-6 space-y-4 no-scrollbar"></div>
        <div class="p-6 border-t border-white/10 flex gap-2">
            <button onclick="document.getElementById('cPicker').click()" class="p-3 glass rounded-xl">üì∑</button>
            <input id="cIn" placeholder="Enter message..." class="flex-1 p-4 rounded-xl text-xs">
            <button onclick="sendMsg('text')" class="neo-btn px-6 rounded-xl font-black">SEND</button>
        </div>
    </div>

    <script>
        let uData = null; let activeChat = null; let isSignUp = false;

        function toggleAuth() {
            isSignUp = !isSignUp;
            document.getElementById('authTitle').innerText = isSignUp ? "IOU SIGN UP" : "IOU SIGN IN";
            document.getElementById('mainBtn').innerText = isSignUp ? "Create Account" : "Authorize";
            document.getElementById('tText').innerText = isSignUp ? "ALREADY HAVE AN ACCOUNT?" : "NEW TO THE NETWORK?";
            document.getElementById('tBtn').innerText = isSignUp ? "SIGN IN" : "CREATE ACCOUNT";
        }

        async function forgotPass() {
            const e = document.getElementById('email').value.trim();
            if(!e) return alert("Enter email first.");
            await auth.sendPasswordResetEmail(e);
            showInfo("RESET DISPATCHED", "Check your email for the recovery link.");
        }

        function showInfo(t, s) {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('infoBox').classList.remove('hidden');
            document.getElementById('infoTitle').innerText = t;
        }

        async function handleAuth() {
            const e = document.getElementById('email').value.trim();
            const p = document.getElementById('pass').value;
            try {
                if(isSignUp) {
                    const uc = await auth.createUserWithEmailAndPassword(e, p);
                    await uc.user.sendEmailVerification();
                    showInfo("VERIFICATION SENT", "Verify your inbox to continue.");
                } else {
                    const uc = await auth.signInWithEmailAndPassword(e, p);
                    if(uc.user.emailVerified) init(uc.user);
                    else { alert("Verify your email first."); auth.signOut(); }
                }
            } catch (err) { alert(err.message); }
        }

        async function init(u) {
            const s = u.email.replace(/\./g, '_');
            db.ref(`users/${s}`).on('value', snap => {
                uData = snap.val() || { lendID: Math.random().toString(36).substr(2,5).toUpperCase(), loans:[], friends:[], profilePic: "", email: u.email };
                if(!snap.exists()) db.ref(`users/${s}`).set(uData);
                render();
            });
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        }

        function render() {
            document.getElementById('hID').innerText = "#" + uData.lendID;
            document.getElementById('hName').innerText = uData.email.split('@')[0];
            const b = (uData.loans || []).reduce((a,c)=>a+c.amount, 0);
            document.getElementById('bal').innerText = `$${b.toFixed(2)}`;
            const av = document.getElementById('hAv');
            av.innerHTML = uData.profilePic ? `<img src="${uData.profilePic}" class="avatar-circle">` : `<div class="w-10 h-10 bg-[#00FF41] rounded-full"></div>`;
            
            const list = document.getElementById('fList'); list.innerHTML = '';
            (uData.friends || []).forEach(f => {
                list.innerHTML += `<div class="glass p-4 rounded-2xl flex justify-between items-center">
                    <p class="font-black text-xs uppercase">${f}</p>
                    <button onclick="openChat('${f}')" class="p-2 glass rounded-lg">üí¨</button>
                </div>`;
            });
        }

        function upImg(input, type) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                if(type==='p') db.ref(`users/${uData.email.replace(/\./g, '_')}/profilePic`).set(base64);
                else sendMsg('image', base64);
            };
            reader.readAsDataURL(input.files[0]);
        }

        function openChat(id) {
            activeChat = id; document.getElementById('chatBox').classList.remove('hidden');
            document.getElementById('cName').innerText = id;
            const cid = [uData.lendID, id].sort().join('_');
            db.ref(`chats/${cid}`).on('value', s => {
                const box = document.getElementById('msgs'); box.innerHTML = '';
                (s.val() || []).forEach(m => {
                    const me = m.s === uData.lendID;
                    box.innerHTML += `<div class="flex ${me ? 'justify-end' : 'justify-start'}">
                        <div class="${me ? 'bg-[#00FF41] text-black' : 'border border-[#00FF41] text-white'} p-3 rounded-2xl max-w-[80%] font-bold text-xs">
                            ${m.t === 'image' ? `<img src="${m.i}" class="chat-img">` : m.x}
                        </div>
                    </div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        async function sendMsg(t, content=null) {
            const cid = [uData.lendID, activeChat].sort().join('_');
            const i = document.getElementById('cIn');
            const snap = await db.ref(`chats/${cid}`).once('value');
            const ms = snap.val() || [];
            ms.push({ s: uData.lendID, t, x: t==='text' ? i.value : "", i: t==='image' ? content : "", time: Date.now() });
            db.ref(`chats/${cid}`).set(ms); i.value = '';
        }

        function deposit() {
            const l = uData.loans || []; l.push({amount: 50});
            db.ref(`users/${uData.email.replace(/\./g, '_')}/loans`).set(l);
        }

        function navTo(p) { document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function closeChat() { document.getElementById('chatBox').classList.add('hidden'); }
        auth.onAuthStateChanged(u => { if(u && u.emailVerified) init(u); });
    </script>
</body>
</html>
