<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IOU | Hyper-Neon Finance</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC_O89rLpoYzVZ4ERKBmirOIGhOwwulCIs",
            authDomain: "iou-app-b7ed2.firebaseapp.com",
            databaseURL: "https://iou-app-b7ed2-default-rtdb.firebaseio.com",
            projectId: "iou-app-b7ed2",
            storageBucket: "iou-app-b7ed2.firebasestorage.app",
            messagingSenderId: "607906588480",
            appId: "1:607906588480:web:a64b8ca13884ef5582fca5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
    </script>

    <style>
        :root { --neon: #00FF41; --bg: #050505; }
        body { background-color: var(--bg); color: var(--neon); font-family: sans-serif; overflow-x: hidden; }
        .glass { background: rgba(0, 255, 65, 0.05); border: 1px solid rgba(0, 255, 65, 0.2); backdrop-filter: blur(10px); }
        .neo-btn { background-color: var(--neon); color: #000; font-weight: 900; box-shadow: 0 0 15px rgba(0, 255, 65, 0.4); }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .avatar-circle { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--neon); }
        .chat-img { max-width: 200px; border-radius: 15px; border: 1px solid var(--neon); margin: 5px 0; }
        input { background: #0a0a0a !important; border: 1px solid #222 !important; color: var(--neon) !important; }
        .logo-pulse { animation: pulse 2s infinite; border-radius: 2rem; }
        @keyframes pulse { 0% { box-shadow: 0 0 0px var(--neon); } 50% { box-shadow: 0 0 25px var(--neon); } 100% { box-shadow: 0 0 0px var(--neon); } }
    </style>
</head>
<body>

    <input type="file" id="pPicker" class="hidden" accept="image/*" onchange="upImg(this, 'p')">
    <input type="file" id="cPicker" class="hidden" accept="image/*" onchange="upImg(this, 'c')">

    <div id="authSection" class="fixed inset-0 z-[5000] bg-black flex items-center justify-center p-6 text-center">
        <div class="w-full max-w-md">
            <img src="https://i.postimg.cc/8z9X689C/IOU-LOGO-CUSTOM.png" class="w-40 h-40 mx-auto mb-6 logo-pulse">
            <h1 class="text-2xl font-black italic mb-8 tracking-widest">IOU SIGN IN</h1>
            <div id="loginForm" class="glass p-8 rounded-[2rem]">
                <input type="email" id="email" placeholder="EMAIL" class="w-full p-4 rounded-xl mb-4 font-bold uppercase">
                <input type="password" id="pass" placeholder="KEY" class="w-full p-4 rounded-xl mb-6 font-bold uppercase">
                <button onclick="doAuth()" class="w-full neo-btn py-4 rounded-xl uppercase">Authorize</button>
            </div>
            <div id="vPrompt" class="hidden glass p-8 rounded-[2rem]">
                <p class="font-bold mb-4">VERIFICATION SENT</p>
                <button onclick="location.reload()" class="w-full neo-btn py-4 rounded-xl">CHECK STATUS</button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden h-screen flex flex-col">
        <header class="p-6 border-b border-white/10 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="document.getElementById('pPicker').click()">
                <div id="hAv"></div>
                <div>
                    <p id="hName" class="font-black text-xs text-white uppercase">USER</p>
                    <p id="hID" class="text-[9px] font-bold opacity-50">#ID</p>
                </div>
            </div>
            <button onclick="auth.signOut().then(()=>location.reload())" class="text-[9px] border border-white/10 px-3 py-1 rounded">EXIT</button>
        </header>

        <main class="flex-1 overflow-y-auto p-6 no-scrollbar pb-24">
            <section id="page-home" class="page active">
                <div class="glass p-8 rounded-[2rem] text-center mb-8 border-2 border-[#00FF41]">
                    <p class="text-[10px] font-black opacity-50 mb-1 tracking-widest uppercase">Credits</p>
                    <h2 id="bal" class="text-5xl font-black text-white">$0.00</h2>
                </div>
                <div class="grid grid-cols-4 gap-4 text-center mb-10">
                    <button onclick="navTo('finance')">üí≥</button>
                    <button onclick="navTo('social')">üí¨</button>
                    <button onclick="navTo('save')">üéØ</button>
                    <button onclick="navTo('social')">üë•</button>
                </div>
                <div id="feed" class="space-y-4"></div>
            </section>

            <section id="page-social" class="page">
                <div class="flex gap-2 mb-6">
                    <input id="fID" placeholder="LINK ID" class="flex-1 p-3 rounded-xl uppercase text-xs">
                    <button onclick="addFriend()" class="neo-btn px-6 rounded-xl">+</button>
                </div>
                <div id="fList" class="space-y-4"></div>
            </section>

            <section id="page-finance" class="page text-center">
                <button onclick="deposit()" class="w-full neo-btn py-5 rounded-2xl uppercase">Add $50.00 Credit</button>
            </section>

            <section id="page-save" class="page">
                <div class="glass p-8 rounded-[2rem] text-center border-2 border-[#00FF41]">
                    <h2 class="text-xl font-black mb-4">GOAL</h2>
                    <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden"><div id="sBar" class="bg-[#00FF41] h-full" style="width:0%"></div></div>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-0 inset-x-0 p-6 glass border-t border-white/10 flex justify-around">
            <button onclick="navTo('home')">üè†</button>
            <button onclick="navTo('social')">üë•</button>
            <button onclick="navTo('save')">üéØ</button>
        </nav>
    </div>

    <div id="chatBox" class="hidden fixed inset-0 bg-black z-[6000] flex flex-col">
        <header class="p-6 border-b border-white/10 flex justify-between items-center">
            <h2 id="cName" class="font-black italic uppercase">CHANNEL</h2>
            <button onclick="closeChat()" class="text-[10px] border border-white/20 px-3 py-1 rounded">BACK</button>
        </header>
        <div id="msgs" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
        <div id="typing" class="px-6 pb-2 text-[10px] italic opacity-0">Typing...</div>
        <div class="p-6 border-t border-white/10">
            <div class="flex gap-2">
                <button onclick="document.getElementById('cPicker').click()" class="p-3 glass rounded-xl">üì∑</button>
                <input id="cIn" placeholder="Message..." class="flex-1 p-4 rounded-xl text-xs" oninput="isTyping()">
                <button onclick="sendMsg('text')" class="neo-btn px-6 rounded-xl">SEND</button>
            </div>
        </div>
    </div>

    <script>
        let uData = null; let activeChat = null; let nicknames = JSON.parse(localStorage.getItem('iou_nicks') || '{}');

        async function doAuth() {
            const e = document.getElementById('email').value.trim();
            const p = document.getElementById('pass').value;
            try {
                const uc = await auth.signInWithEmailAndPassword(e, p);
                if (uc.user.emailVerified) init(uc.user);
                else { alert("Verify Email"); auth.signOut(); }
            } catch (err) {
                if (err.code === 'auth/user-not-found') {
                    const nu = await auth.createUserWithEmailAndPassword(e, p);
                    await nu.user.sendEmailVerification();
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('vPrompt').classList.remove('hidden');
                } else alert(err.message);
            }
        }

        async function init(u) {
            const s = u.email.replace(/\./g, '_');
            db.ref(`users/${s}`).on('value', snap => {
                uData = snap.val() || { lendID: Math.random().toString(36).substr(2,5).toUpperCase(), loans:[], friends:[], profilePic: "" };
                if(!snap.exists()) db.ref(`users/${s}`).set(uData);
                render();
            });
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        }

        function render() {
            document.getElementById('hID').innerText = "#" + uData.lendID;
            document.getElementById('hName').innerText = uData.email.split('@')[0];
            const b = (uData.loans || []).reduce((a,c)=>a+c.amount, 0);
            document.getElementById('bal').innerText = `$${b.toFixed(2)}`;
            const av = document.getElementById('hAv');
            av.innerHTML = uData.profilePic ? `<img src="${uData.profilePic}" class="avatar-circle">` : `<div class="w-10 h-10 bg-[#00FF41] rounded-full"></div>`;
            
            const list = document.getElementById('fList'); list.innerHTML = '';
            (uData.friends || []).forEach(f => {
                list.innerHTML += `<div class="glass p-4 rounded-2xl flex justify-between items-center">
                    <p class="font-black text-xs uppercase">${nicknames[f] || f}</p>
                    <button onclick="openChat('${f}')" class="p-2 glass rounded-lg">üí¨</button>
                </div>`;
            });
        }

        function upImg(input, type) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                if(type==='p') db.ref(`users/${uData.email.replace(/\./g, '_')}/profilePic`).set(base64);
                else sendMsg('image', base64);
            };
            reader.readAsDataURL(input.files[0]);
        }

        function openChat(id) {
            activeChat = id; document.getElementById('chatBox').classList.remove('hidden');
            const cid = [uData.lendID, id].sort().join('_');
            db.ref(`chats/${cid}`).on('value', s => {
                const box = document.getElementById('msgs'); box.innerHTML = '';
                (s.val() || []).forEach(m => {
                    const me = m.s === uData.lendID;
                    box.innerHTML += `<div class="flex ${me ? 'justify-end' : 'justify-start'}">
                        <div class="${me ? 'bg-[#00FF41] text-black' : 'border border-[#00FF41] text-white'} p-3 rounded-2xl max-w-[80%] font-bold">
                            ${m.t === 'image' ? `<img src="${m.i}" class="chat-img">` : m.x}
                        </div>
                    </div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        async function sendMsg(t, content=null) {
            const cid = [uData.lendID, activeChat].sort().join('_');
            const i = document.getElementById('cIn');
            const snap = await db.ref(`chats/${cid}`).once('value');
            const ms = snap.val() || [];
            ms.push({ s: uData.lendID, t, x: t==='text' ? i.value : "", i: t==='image' ? content : "", time: Date.now() });
            db.ref(`chats/${cid}`).set(ms); i.value = '';
        }

        function deposit() {
            const l = uData.loans || []; l.push({amount: 50});
            db.ref(`users/${uData.email.replace(/\./g, '_')}/loans`).set(l);
        }

        function navTo(p) { document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function closeChat() { document.getElementById('chatBox').classList.add('hidden'); }
        auth.onAuthStateChanged(u => { if(u && u.emailVerified) init(u); });
    </script>
</body>
</html>
